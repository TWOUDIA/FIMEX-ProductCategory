angular.module("fimex",["ionic","ngCookies","ngMessages","angular.filter","pascalprecht.translate","tmh.dynamicLocale","toaster","fimex.config","fimex.controllers","fimex.directives","fimex.filters","fimex.services","fimex.info"]).run(["$ionicPlatform","toaster","$filter","$timeout",function(e,t,a,r){e.ready(function(){cordova.plugins.Keyboard.disableScroll(!0),window.StatusBar&&!ionic.Platform.isAndroid()&&StatusBar.styleLightContent()});var n=!1;e.registerBackButtonAction(function(e){return e.preventDefault(),n?ionic.Platform.exitApp():(n=!0,r(function(){t.pop({type:"error",body:a("translate")("CLICK_AGAIN_TO_EXIT_APP")})},0),r(function(){n=!1},5e3)),!1},101)}]).config(["$ionicConfigProvider","tmhDynamicLocaleProvider","$translateProvider","$stateProvider","$urlRouterProvider",function(e,t,a,r,n){e.tabs.position("bottom"),t.localeLocationPattern("locales/angular-locale_{{locale}}.js"),a.useStaticFilesLoader({prefix:"i18n/",suffix:".json"}).registerAvailableLanguageKeys(["ar","de","en","es","fr","pt","ru","zh"],{ar:"ar","ar_*":"ar",de:"de","de_*":"de",en:"en","en_*":"en",es:"es","es_*":"es",fr:"fr","fr_*":"fr",pt:"pt","pt_*":"pt",ru:"ru","ru_*":"ru",zh:"zh","zh_*":"zh"}).preferredLanguage("de").fallbackLanguage(["en","zh","es","fr"]).determinePreferredLanguage().useSanitizeValueStrategy("escapeParameters").useLocalStorage(),r.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.dash",{url:"/dash",cache:!0,views:{"tab-dash":{templateUrl:"templates/tab-dash.html",controller:"DashCtrl"}}}).state("tab.categories",{url:"/categories/{categoryLevel}/{categoryId}/{categorySlug}/{categoryName:.*}",cache:!0,views:{"tab-categories":{templateUrl:function(e){return"3"==e.categoryLevel?"templates/categories-products.html":"templates/tab-categories.html"},controller:"CategoriesCtrl"}}}).state("tab.search",{url:"/search",cache:!1,views:{"tab-search":{templateUrl:"templates/tab-search.html",controller:"SearchCtrl"}}}).state("tab.setting",{url:"/setting",views:{"tab-setting":{templateUrl:"templates/tab-setting.html",controller:"SettingCtrl"}}}),n.otherwise("/tab/dash")}]),angular.module("fimex.config",[]).constant("AppConfig",{appName:"FIMEX PRODUCT CATEGORIES",domainURI:"https://beta.fimex.com.tw/",wcAPIURI:"wc-api/v3/",wcAPIKey:"ck_e3d52fbb954e57758cc7ea5bdadb6d44d9fd8be3",wcAPISecret:"cs_894c2f79bd330af5eba70473c6a921593139f034",wcAPIURIsuffix:"filter[orderby]=id&filter[order]=ASC&filter[limit]=",wcAPIRSlimit:5,wcConnectTimeout:1e4,mgAPIName:"api",mgServiceKey:"key-0c16845e030f782c3acb501cdf07b8a2",mgAPIURI:"https://api.mailgun.net/v3/mg.fimex.com.tw/messages",contactForm2Email:"yannicklin@twoudia.com",contactForm2User:"Support",mgConnectTimeout:1e4,oriCategories:[{id:9,name:"Electrical Materials",slug:"electrical-materials",parent:0,description:"",display:"default",image:"",count:0,sublevels:2},{id:10,name:"Electrical Materials - American Category",slug:"electrical-materials-aa",parent:0,description:"",display:"default",image:"",count:0,sublevels:2},{id:11,name:"Wiring Devices",slug:"wiring-devices",parent:0,description:"",display:"default",image:"",count:0,sublevels:3}]}),angular.module("fimex.services",[]).factory("DataLoader",["$http","AppSettings",function(e,t){return{get:function(a,r){var n=e({method:"GET",url:t.getURI(a,r)+"&consumer_key="+t.get("wcAPIKey")+"&consumer_secret="+t.get("wcAPISecret"),timeout:t.get("wcConnectTimeout")});return n}}}]).factory("PHPJSfunc",function(){return{urlencode:function(e){e=(e+"").toString();var t=encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+");return t}}}).factory("EmailSender",["$http","$log","AppSettings",function(e,t,a){return{send:function(r){return e({method:"POST",url:a.get("mgAPIURI"),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8",Authorization:"Basic "+a.getAuthPhrase(a.get("mgAPIName"),a.get("mgServiceKey"))},transformRequest:function(e){var t=[];for(var a in e)e[a].length>0&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},data:r,timeout:a.get("mgConnectTimeout")}).then(function(){t.debug("successful email send.")},function(){t.debug("error sending email.")}),null}}}]).factory("AppSettings",["$translate","tmhDynamicLocale","AppConfig",function(e,t,a){function r(e){switch(e){case"en":n.languageURI="";break;case"zh":n.languageURI="zh-hant/";break;default:n.languageURI=e+"/"}}var n=a;return n.wcCategories=[],n.appFIMEXCategoriesRS="",n.language=e.use(),r(n.language),{change:function(a,o){n[a]=o,"language"==a&&(r(o),e.use(o),t.set(o))},get:function(e){return n[e]},getURI:function(e,t){return n.languageURI="",t=0==t?n.wcAPIRSlimit:t,e?n.domainURI+n.languageURI+n.wcAPIURI+e+n.wcAPIURIsuffix+t:n.domainURI+n.languageURI+n.wcAPIURI+"?"+n.wcAPIURIsuffix+t},getAuthPhrase:function(e,t){return btoa(e+":"+t)}}}]),angular.module("fimex.controllers",[]).controller("DashCtrl",["$scope","Notes","$filter","$log","DataLoader","AppSettings","$ionicLoading",function(e,t,a,r,n,o,i){var c=t.all();e.notesNormal=a("filter")(c,{top:0}),e.notesTop=a("filter")(c,{top:1}),e.notesCount=c.length,e.today=new Date,0==o.get("wcCategories").length&&(i.show({template:'<ion-spinner icon="lines" class="spinner-energized"></ion-spinner>'+a("translate")("LOADING_TEXT")}),n.get("products/categories?",1e3).then(function(e){o.change("wcCategories",e.data.product_categories),i.hide()},function(e){r.error("error",e),i.hide()}))}]).controller("CategoriesCtrl",["$ionicHistory","$rootScope","$filter","AppSettings","$stateParams","$scope","DataLoader","$log","$ionicLoading","$ionicModal","$ionicSlideBoxDelegate",function(e,t,a,r,n,o,i,c,l,s,d){l.show({template:'<ion-spinner icon="lines" class="spinner-energized"></ion-spinner>'+a("translate")("LOADING_TEXT")}),o.RSempty=!1;var u=1;o.able2Loadmore=0;var g=" >> ";o.RSitemURI="#/tab/categories/"+(parseInt(n.categoryLevel)+1);var p=r.get("appFIMEXCategoriesRS"),m=p.split(g,2);switch(o.showCount=0,parseInt(n.categoryLevel)){case 0:o.loadResult=function(){o.categories=r.get("oriCategories"),l.hide()};break;case 3:o.loadResult=function(){i.get("products?filter[category]="+n.categorySlug+"&",0).then(function(e){0==e.data.products.length?(o.products=null,o.RSempty=!0):(o.products=e.data.products,e.data.products.length==r.get("wcAPIRSlimit")&&(u++,o.able2Loadmore=1)),l.hide()},function(e){c.error("error",e),l.hide(),o.RSempty=!0})},p=m[0]+g+m[1];break;case 2:o.showCount=1;default:o.loadResult=function(){o.categories=a("filter")(r.get("wcCategories"),{parent:parseInt(n.categoryId)},!0),0==o.categories.length&&(o.categories=null,o.RSempty=!0),l.hide()},p=parseInt(n.categoryLevel)>1?m[0]:""}0==parseInt(n.categoryLevel)?(o.titleSub="",r.change("appFIMEXCategoriesRS","")):(o.titleSub=""==p?a("unescapeHTML")(n.categoryName):p+g+a("unescapeHTML")(n.categoryName),r.change("appFIMEXCategoriesRS",o.titleSub)),o.loadResult(),o.loadMore=function(){l.show({template:'<ion-spinner icon="lines" class="spinner-energized"></ion-spinner>'+a("translate")("LOADING_MORE_TEXT")}),o.able2Loadmore=0,i.get("products?filter[category]="+n.categorySlug+"&page="+u,0).then(function(e){e.data.products.length>0&&(o.products=o.products.concat(e.data.products),e.data.products.length==r.get("wcAPIRSlimit")&&(u++,o.able2Loadmore=1)),l.hide(),o.$broadcast("scroll.infiniteScrollComplete")},function(e){c.error("error",e),l.hide(),o.$broadcast("scroll.infiniteScrollComplete")})},s.fromTemplateUrl("templates/product-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.detail=null,o.detailImg=null}),o.openModal=function(e){o.detail=e,o.detailImg=a("unique")(o.detail.images,"src"),d.update(),o.modal.show()},o.closeModal=function(){o.modal.hide()},o.$on("$destroy",function(){o.modal.remove()})}]).controller("SearchCtrl",["AppSettings","PHPJSfunc","$scope","DataLoader","$log","$filter","$ionicLoading","$ionicModal","$ionicSlideBoxDelegate",function(e,t,a,r,n,o,i,c,l){a.search={};var s=1;a.able2Loadmore=0,a.cleanSearch=function(){a.search.term="",a.products=null,a.RSempty=!1},a.doSearch=function(){a.search.term&&(cordova.plugins.Keyboard.close(),a.loadResult())},a.loadResult=function(){i.show({template:'<ion-spinner icon="lines" class="spinner-energized"></ion-spinner>'+o("translate")("LOADING_TEXT")}),a.RSempty=!1,r.get("products?filter[q]="+t.urlencode(a.search.term)+"&",0).then(function(t){0==t.data.products.length?(a.products=null,a.RSempty=!0):(a.products=t.data.products,t.data.products.length==e.get("wcAPIRSlimit")&&(s++,a.able2Loadmore=1)),i.hide()},function(e){n.error("error",e),i.hide(),a.RSempty=!0})},a.loadMore=function(){i.show({template:'<ion-spinner icon="lines" class="spinner-energized"></ion-spinner>'+o("translate")("LOADING_MORE_TEXT")}),a.able2Loadmore=0,r.get("products?filter[q]="+t.urlencode(a.search.term)+"&page="+s,0).then(function(t){t.data.products.length>0&&(a.products=a.products.concat(t.data.products),t.data.products.length==e.get("wcAPIRSlimit")&&(s++,a.able2Loadmore=1)),i.hide(),a.$broadcast("scroll.infiniteScrollComplete")},function(e){n.error("error",e),i.hide(),a.$broadcast("scroll.infiniteScrollComplete")})},c.fromTemplateUrl("templates/product-modal.html",{scope:a,animation:"slide-in-up"}).then(function(e){a.modal=e,a.detail=null,a.detailImg=null}),a.openModal=function(e){a.detail=e,a.detailImg=o("unique")(a.detail.images,"src"),l.update(),a.modal.show()},a.closeModal=function(){a.modal.hide()},a.$on("$destroy",function(){a.modal.remove()})}]).controller("SettingCtrl",["$state","$scope","$translate","AppSettings","$ionicHistory","EmailSender","$filter","toaster","$timeout",function(e,t,a,r,n,o,i,c,l){t.forms={},t.ctForm={},t.settings={language:a.use()},t.$watch("settings.language",function(){t.settings.language!=r.get("language")&&(r.change("language",t.settings.language),n.clearCache(),n.clearHistory(),r.change("wcCategories",[]),l(function(){e.go("tab.dash",{reload:!0})},50))}),t.formSubmit=function(){var e={from:t.ctForm.ctName+" <"+t.ctForm.ctEmail+">",to:r.get("contactForm2User")+" <"+r.get("contactForm2Email")+">",cc:"",bcc:"",subject:"Message sent via Mobile APP - "+r.get("appName")+", "+i("date")(Date.now(),"yyyy-MM-dd HH:mm Z"),html:'<table style="border: 1px dashed black; border-collapse: collapse;"><caption>'+r.get("appName")+'</caption><tfoot style="color: red;"><tr><td style="border: 1px dashed black; padding: 5px;">Time</td><td style="border: 1px dashed black; padding: 5px;">'+i("date")(Date.now(),"yyyy-MM-dd HH:mm Z")+'</td></tr><tr><td style="border: 1px dashed black; padding: 5px;">SPEC</td><td style="border: 1px dashed black; padding: 5px;">Platform: '+device.platform+", Version: "+device.version+", Manufacturer: "+device.manufacturer+", Model: "+device.model+", UUID: "+device.uuid+'</td></tr></tfoot><tbody><tr><td style="border: 1px dashed black; padding: 5px;">Name</td><td style="border: 1px dashed black; padding: 5px;">'+t.ctForm.ctName+'</td></tr><tr><td style="border: 1px dashed black; padding: 5px;">Email</td><td style="border: 1px dashed black; padding: 5px;">'+t.ctForm.ctEmail+'</td></tr><tr><td style="border: 1px dashed black; padding: 5px;">Message</td><td style="border: 1px dashed black; padding: 5px;">'+t.ctForm.ctMessage+"</td></tr></tbody></table>",text:"TEXT VERSION: "+t.ctForm.ctMessage};o.send(e),c.pop({type:"info",body:i("translate")("ALERT_MAIL_SENT",{name:t.ctForm.ctName})}),t.ctForm={},t.forms.contactForm.$setPristine()}}]),angular.module("fimex.directives",[]).directive("gpRadio",function(){return{restrict:"AE",require:"ngModel",scope:{model:"=ngModel",value:"=gpRadio"},link:function(e,t,a,r){t.addClass("button"),t.on("click",function(t){e.$apply(function(){r.$setViewValue(e.value)})}),e.$watch("model",function(a){t.removeClass("button-positive"),a===e.value&&t.addClass("button-positive")})}}}).directive("keyInput",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.keyInput)}),t.preventDefault())})}}).directive("keyboardHide",function(){return{restrict:"A",link:function(e,t,a){e.$watch("native.keyboardshow",function(){t.addClass("hide")}),e.$watch("native.keyboardhide",function(){t.removeClass("hide")})}}}),angular.module("fimex.filters",[]).filter("partRemove",["$sce",function(e){return function(t,a){var r=document.createElement("div");r.innerHTML=t;for(var n=r.getElementsByTagName(a),o=n.length;o>0;o--)n[o-1].parentNode.removeChild(n[o-1]);return e.trustAsHtml(r.outerHTML)}}]).filter("unicode",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("unescapeHTML",function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return function(t){return angular.forEach(e,function(e,a){t=String(t).replace(new RegExp(e,"gi"),a)}),t}}),angular.module("fimex.info",[]).factory("Notes",function(){var e=[{id:0,top:0,title:"NOTES_20160107_TITLE",content:"NOTES_20160107_CONTENT"},{id:1,top:0,title:"NOTES_20160108_TITLE",content:"NOTES_20160108_CONTENT"},{id:2,top:1,title:"NOTES_20160109_TITLE",content:"NOTES_20160109_CONTENT"}];return{all:function(){return e},get:function(t){for(var a=0;a<e.length;a++)if(e[a].id===parseInt(t))return e[a];return null}}});